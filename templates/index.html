<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ask Rachel</title>
    <style>
      :root { --bg: #0f172a; --panel: #111827; --text: #e5e7eb; --muted: #9ca3af; --accent: #8b5cf6; }
      * { box-sizing: border-box; }
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: linear-gradient(180deg, #0b1020, #111827); color: var(--text); height: 100vh; display: grid; place-items: center; }
      .container { width: min(900px, 92vw); height: min(720px, 92vh); display: grid; grid-template-rows: auto 1fr auto; gap: 12px; background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(139, 92, 246, 0.15); border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.03); backdrop-filter: blur(8px); }
      header { padding: 16px 18px; border-bottom: 1px solid rgba(139, 92, 246, 0.15); display: flex; align-items: center; gap: 10px; }
      header .dot { width: 10px; height: 10px; border-radius: 50%; background: linear-gradient(135deg, #22d3ee, #8b5cf6); box-shadow: 0 0 12px #8b5cf6; }
      header h1 { margin: 0; font-size: 18px; letter-spacing: 0.3px; }
      #messages { padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
      .msg { max-width: 80%; padding: 10px 12px; border-radius: 12px; line-height: 1.4; box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
      .user { align-self: flex-end; background: linear-gradient(135deg, #8b5cf6, #3b82f6); color: white; border-bottom-right-radius: 4px; }
      .bot { align-self: flex-start; background: rgba(255,255,255,0.06); border: 1px solid rgba(139, 92, 246, 0.15); border-bottom-left-radius: 4px; }
      form { display: grid; grid-template-columns: 1fr auto; gap: 10px; padding: 12px; border-top: 1px solid rgba(139, 92, 246, 0.15); }
      input[type="text"] { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(139,92,246,0.25); background: rgba(17, 24, 39, 0.6); color: var(--text); outline: none; box-shadow: inset 0 1px 0 rgba(255,255,255,0.04); }
      button { padding: 12px 18px; border-radius: 12px; background: linear-gradient(135deg, #8b5cf6, #3b82f6); border: none; color: white; font-weight: 600; letter-spacing: 0.3px; cursor: pointer; box-shadow: 0 10px 25px rgba(59, 130, 246, 0.35); }
      button:hover { filter: brightness(1.05); }
      .hint { color: var(--muted); font-size: 12px; text-align: center; padding-bottom: 6px; }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="dot"></div>
        <h1>Ask Rachel</h1>
      </header>
      <div id="messages" aria-live="polite">
        <div class="msg bot">Hi! Ask me anything about your knowledge base.</div>
      </div>
      <div class="hint">Ask a question and I will retrieve context from your knowledge base.</div>
      <form id="chat-form" onsubmit="return sendMessage(event)">
        <input id="input" type="text" placeholder="Type your message..." autocomplete="off" required />
        <button type="submit">Send</button>
      </form>
    </div>
    <script>
      function appendMessage(text, cls) {
        const wrap = document.getElementById('messages');
        const el = document.createElement('div');
        el.className = 'msg ' + cls;
        el.textContent = text;
        wrap.appendChild(el);
        wrap.scrollTop = wrap.scrollHeight;
      }

      async function sendMessage(e) {
        e.preventDefault();
        const input = document.getElementById('input');
        const text = input.value.trim();
        if (!text) return false;
        appendMessage(text, 'user');
        input.value = '';
        try {
          const res = await fetch('/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: text })
          });
          const data = await res.json();
          if (!res.ok) {
            appendMessage(data.error || 'Error retrieving context', 'bot');
          } else {
            const ctx = data.context && data.context.trim() ? data.context : '(No relevant context found)';
            appendMessage(ctx, 'bot');
          }
        } catch (err) {
          appendMessage('Network error talking to /ask', 'bot');
        }
        return false;
      }
    </script>
  </body>
  </html>

